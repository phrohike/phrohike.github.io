<!DOCTYPE html>
<html lang="En"> 
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="generator" content="RocketCake">
<script src="https://kit.fontawesome.com/00018f73bf.js" crossorigin="anonymous"></script>
	<title></title>
	<link rel="stylesheet" type="text/css" href="../posts/splunklab1_html.css?h=77f5f3f9">
</head>
<body>
<div class="textstyle1">
<div id="container_9a2f929"><div class="textstyle2"><table id="table_45286c53" cellpadding="0" cellspacing="0" >	<tr>
		<td width="25%" height="61px" style="vertical-align: top; overflow:hidden; ">  <div id="cell_5db600f5">
    <div class="textstyle2">
<span class="textstyle3"><br/></span><span class="textstyle3"><a href="../index.html">Home</a></span>      </div>
    </div>
		</td>
		<td width="25%" height="61px" style="vertical-align: top; overflow:hidden; ">  <div id="cell_517e11b4">
    <div class="textstyle2">
<span class="textstyle3"><br/></span><span class="textstyle3"><a href="../sub/resume.html">Resume</a></span>      </div>
    </div>
		</td>
		<td width="25%" height="61px" style="vertical-align: top; overflow:hidden; ">  <div id="cell_506a203d">
    <div class="textstyle2">
<span class="textstyle3"><br/></span><span class="textstyle3"><a href="../index.html#projects">Skills/Projects</a></span>      </div>
    </div>
		</td>
		<td width="25%" height="61px" style="vertical-align: top; overflow:hidden; ">  <div id="cell_50e330bf">
    <div class="textstyle2">
<span class="textstyle3"><br/></span><span class="textstyle3"><a href="../index.html#recent">Recent Posts</a></span>      </div>
    </div>
		</td>
	</tr>
</table></div>
</div><div id="container_7a6892a9"><div id="container_7a6892a9_padding" ></div></div><div id="container_36c3f106"><div id="container_36c3f106_padding" ><div class="textstyle2">  <span class="textstyle4">Splunk Incident Response Lab</span>
</div>
</div></div><div id="container_219c7478"><div class="textstyle1"><span class="textstyle5"><br/><br/><br/><br/></span></div>
<div class="textstyle2"><div id="container_338048cb"><div id="container_338048cb_padding" ><div class="textstyle1"><span class="textstyle6">Keith Brady 1/16/25<br/><br/></span></div>
<div class="textstyle2"><img src="../images/dalle_splunk__1200x685.png" width="1200" height="685" id="img_46ccc96c" alt="" title="" /></div>
<div class="textstyle1"><span class="textstyle6"><br/><br/><br/></span><span class="textstyle7">Goal </span><span class="textstyle6"><br/><br/>As a SOC analyst using Splunk (or any SIEM), understanding attackers' tactics, techniques, and procedures is crucial to effectively defend against potential threats. Incident handling consists of four phases: preparation, detection and analysis, containment and recovery, and post-incident activities. The preparation phase involves readiness measures like defining policies, implementing security controls (e.g., SIEM, EDR), and ensuring skilled personnel are available.<br/><br/>The detection and analysis phase focuses on identifying incidents through alerts and investigating their root causes, often leveraging Splunk&#8217;s capabilities for threat detection and analysis. Containment, eradication, and recovery involve isolating infected systems, removing traces of the attack, and restoring control. Finally, post-incident activities emphasize identifying and addressing security gaps, creating new detection rules, and enhancing team training to prevent future attacks.<br/><br/>We will be using the Incident Handling Life Cycle as well as the Lockheed Martin - Cyber Kill Chain method during our analysis to map our attacker(s) activity. <br/><br/></span><span class="textstyle7">Scenario</span><span class="textstyle6"><br/><br/>&quot;A Big corporate organization Wayne Enterprises has recently faced a cyber-attack where the attackers broke into their network, found their way to their web server, and have successfully defaced their website http://www.imreallynotbatman.com. Their website is now showing the trademark of the attackers with the message YOUR SITE HAS BEEN DEFACED.&quot;<br/><br/>In this lab, follow along as we hunt for threats. <br/></span><span class="textstyle7"><br/>The Steps</span><span class="textstyle6"><br/><br/>1. Log into a live Splunk session with Forwarders already setup and actively obtaining metrics. This instance is pulling metrics from Windows IIS Webserver Logs, Sysmon, Windows Registry, Nessus network scanner, Fortigate firewall logs, Suricata IDS logs, and also http/dns/icmp streams. <br/><br/>2. Here we can see the events that occured during the defacement of the website amongst other events.<br/><br/></span><img src="../images/image_001_1737045811_1200x773.png" width="1200" height="773" id="img_6eb94f14" alt="" title="" /><span class="textstyle6"><br/><br/>3. Recon Phase - We will narrow it down using the http stream to determine which IPs were scanning the webserver (192.168.250.70). We find two suspicious IPs and we will dig into more logs to determine what they were trying to enumerate/exfil. We can then see from the logs that the IPs triggered alerts within Suricata related to a CVE (ET WEB_SERVER Possible CVE-2014-6271 Attempt). <br/><br/></span><img src="../images/image_001_1737046428_1200x773.png" width="1200" height="773" id="img_6ebb91ba" alt="" title="" /><span class="textstyle6"><br/><br/></span><img src="../images/image_001_1737046595_1200x768.png" width="1200" height="768" id="img_580f32ba" alt="" title="" /><span class="textstyle6"><br/><br/></span><img src="../images/image_001_1737046823_1200x775.png" width="1200" height="775" id="img_71ee6381" alt="" title="" /><span class="textstyle6"><br/><br/>3. Exploit Phase - In this phase we are going to determine the exploitation method used by the attacker(s) to compromise the website and deface it. After some initial queries we determine the server is running Joomla CMS and that the attacking IP (23.22.63.114) is using a brute force technique to find the password for the CMS admin account at the URI &quot;/joomla/administrator/index.php&quot;. We can then use rex (RegEx) in splunk to isolate which user agents were used in the attack. This showed that the attacker used a python script to automate the brute force attack. Once we searched for just the passwords used, we can see that the IP (40.80.148.42) used a single password to attempt login (batman). <br/><br/></span><img src="../images/image_001_1737055077_1200x687.png" width="1200" height="687" id="img_5676e254" alt="" title="" /><span class="textstyle6"><br/><br/></span><img src="../images/image_001_1737055810_1200x684.png" width="1200" height="684" id="img_7944c2d2" alt="" title="" /><span class="textstyle6"><br/><br/></span><img src="../images/image_001_1737055657_1200x686.png" width="1200" height="686" id="img_6c5a1430" alt="" title="" /><span class="textstyle6"><br/><br/>4. Installation Phase - Now that we determined what the attacker did to gain access to the Joomla CMS/Webserver, we will now determine what they did post exploitation. Since we know the webserver is Windows-based, lets look for .exe files. We then find a file named &quot;3791.exe&quot; uploaded by the attack IP (40.80.148.42). To determine if the file was run on the webserver, we will check the server's Windows event logs (sysmon). Sysmon confirms that 3791.exe was execute on the server.<br/><br/></span><img src="../images/image_001_1737057465_1200x683.png" width="1200" height="683" id="img_13be948d" alt="" title="" /><span class="textstyle6"><br/><br/></span><img src="../images/image_001_1737057797_1200x686.png" width="1200" height="686" id="img_4bad1ee1" alt="" title="" /><span class="textstyle6"><br/><br/></span><img src="../images/image_001_1737058027_1200x683.png" width="1200" height="683" id="img_5830792d" alt="" title="" /><span class="textstyle6"><br/><br/>5. Action on Objective Phase - Now lets determine what ended up on the server to pull off the website defacement. After reviewing Suricata, we determine that the 3973.exe program established outbound connections to three IPs likely C2 server(s). After checking the three suspicious IPs (one which is the original attackers IP), we find out that a SQL injection (HTTP.URI.SQL.Injection) was used and that the file named &quot;poisonivy-is-coming-for-you-batman.jpeg&quot; was used to deface the website.<br/><br/></span><img src="../images/image_001_1737059535_1200x681.png" width="1200" height="681" id="img_494a6936" alt="" title="" /><span class="textstyle6"><br/><br/></span><img src="../images/image_001_1737059614_1200x685.png" width="1200" height="685" id="img_43f3c25d" alt="" title="" /><span class="textstyle6"><br/><br/></span><img src="../images/image_001_1737059697_1200x687.png" width="1200" height="687" id="img_57daeb87" alt="" title="" /><span class="textstyle6"><br/><br/>6. Command and Control Phase - Now that we identified where the jpeg was uploaded from, lets determine if we can find the IP of the C2 server the attacker is using. We will check the Fortigate Firewall to determine this. The jpeg file was downloaded from the attack host prankglassinebracket.jumpingcrab.com (23.22.63.114).<br/><br/></span><img src="../images/image_001_1737061992_1200x682.png" width="1200" height="682" id="img_4f27dd3c" alt="" title="" /><span class="textstyle6"><br/><br/></span><img src="../images/image_001_1737062067_1200x681.png" width="1200" height="681" id="img_53f82aee" alt="" title="" /><span class="textstyle6"><br/><br/></span><span class="textstyle8">*Note about the last 2 phases (Weaponization and Delivery) - The THM lab is now 5 years old and the threat hunting/OSINT sites no longer contain information about the orignal AWS instancences when they were set up as fictitious &quot;attackers&quot; domains. Now all availble information is just referencing Amazon AWS.</span><span class="textstyle6"><br/><br/>7. Weaponization Phase - Now that we have determined the domain associated with the attack via the jpeg upload, we will look further into information about the domain via a threat intelligence sites. We will look for any information like IP addresses/domains/email addresses associated with this domain which could help us know more about this attacker. Robtex.com is the only OSINT site that has any infomation about the lab attacker domain still. Virustotal would have given us information about a sibling domain - www.po1s0n1vy.com. <br/><br/></span><img src="../images/image_001_1737062682_1200x705.png" width="1200" height="705" id="img_75dd1732" alt="" title="" /><span class="textstyle6"><br/><br/></span><img src="../images/image_001_1737062703_1200x622.png" width="1200" height="622" id="img_2ed68a52" alt="" title="" /><span class="textstyle6"><br/><br/></span><img src="../images/image_001_1737062937_1200x705.png" width="1200" height="705" id="img_bd0ea9" alt="" title="" /><span class="textstyle6"><br/><br/><br/>8. Delivery Phase - See note above* - &quot;Attackers create malware and infect devices to gain initial access or evade defenses and find ways to deliver it through different means. We have identified various IP addresses, domains and Email addresses associated with this adversary. Our task for this lesson would be to use the information we have about the adversary and use various Threat Hunting platforms and OSINT sites to find any malware linked with the adversary.&quot;<br/><br/>I was able to use LBL's AlienVault to find more information about the now antiquated attackers domain (www.po1s0n1vy.com). I was also able to find the associated attackers email address - lillian.rose@po1s0n1vy.com.<br/><br/></span><img src="../images/image_001_1737065945_1200x703.png" width="1200" height="703" id="img_774b48e4" alt="" title="" /><span class="textstyle6"><br/><br/></span><img src="../images/image_001_1737065997_1200x703.png" width="1200" height="703" id="img_1fac06a5" alt="" title="" /><span class="textstyle6"><br/><br/></span><img src="../images/image_001_1737065974_1200x703.png" width="1200" height="703" id="img_236ec374" alt="" title="" /><span class="textstyle6"><br/><br/><br/><br/><br/></span><span class="textstyle7">Links</span><span class="textstyle6"><br/><br/></span><span class="textstyle6"><a href="https://tryhackme.com/r/room/splunk201" target="_blank" class="wsp5e11d928">TryHackMe Room - Splunk201</a></span><span class="textstyle6"><br/><br/></span><span class="textstyle6"><a href="https://www.lockheedmartin.com/en-us/capabilities/cyber/cyber-kill-chain.html" target="_blank" class="wsp5e11d928">Lockheed Martin - Cyber Kill Chain</a></span><span class="textstyle6"><br/><br/></span><span class="textstyle6"><a href="https://www.robtex.com/" target="_blank" class="wsp5e11d928">Robtex</a></span><span class="textstyle6"><br/><br/></span><span class="textstyle6"><a href="https://www.virustotal.com/" target="_blank" class="wsp5e11d928">VirusTotal</a></span><span class="textstyle6"><br/><br/></span><span class="textstyle6"><a href="https://otx.alienvault.com/" target="_blank" class="wsp5e11d928">AlienVault</a></span><span class="textstyle6"><br/><br/></span><span class="textstyle5"><br/></span></div>
<div style="clear:both"></div></div></div></div>
<div class="textstyle1"><span class="textstyle5"><br/><br/></span><div id="container_57da07d8"><div id="container_57da07d8_padding" ><div class="textstyle2">  <span class="textstyle5">&#169; phrohike.github.io. All rights reserved.</span>
</div>
</div></div><span class="textstyle5"><br/><br/></span></div>
</div>  </div>
</body>
</html>